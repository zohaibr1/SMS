  {% load static %}
  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Student List | School Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
      .table-responsive {
          box-shadow: 0 2px 6px rgba(0,0,0,0.1);
          border-radius: 10px;
          overflow: hidden;
      }
      .table th {
          background: linear-gradient(135deg,rgb(62, 136, 43),rgb(85, 230, 92));
          color: white;
      }
      .badge {
          margin: 2px;
      }
    </style>
  </head>
  <body class="bg-light">

  <div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="mb-0"><i class="bi bi-table me-2"></i>Student List</h2>
      <div>
        <a href="{% url 'add_students' %}" class="btn btn-success me-2">
          <i class="bi bi-plus-lg"></i> Add Student
        </a>
        <a href="{% url 'school' %}" class="btn btn-outline-secondary" title="Back to Dashboard">
          <i class="bi bi-box-arrow-right"></i>
        </a>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Contact</th>
            <th>Email</th>
            <th>Classroom</th>
            <th>Subjects</th>
            <th>Address</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="studentTable">
          {% include "table_students.html" %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    {% if list_students.has_other_pages %}
    <nav aria-label="Page navigation" class="mt-4">
      <ul class="pagination justify-content-center">
        {% if list_students.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page={{ list_students.previous_page_number }}" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>
        {% endif %}

        {% for i in list_students.paginator.page_range %}
        <li class="page-item {% if list_students.number == i %}active{% endif %}">
          <a class="page-link" href="?page={{ i }}">{{ i }}</a>
        </li>
        {% endfor %}

        {% if list_students.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ list_students.next_page_number }}" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    $(document).ready(function(){
      function loadStudent(){
        $.ajax({
          url:'',
          type:'GET',
          dataType:'json',
          headers:{
            'X-Requested-With':'XMLHttpRequest'
          },
          success:function(response){
            alert('AJAX: fetched data Succefully!!!')
            const sBody=$('#studentTable')
            sBody.empty();
            response.students.forEach(function(student){
              let row=`<tr>
              <td>${ student.id }</td>
            <td>${ student.first_name } ${ student.last_name }</td>
            <td>${ student.contact_no }</td>
            <td>${ student.email }</td>
            <td>${ student.classroom }</td>
             <td>
                ${student.subjects.map(sub => `<span class="badge bg-info text-dark mb-1">${sub}</span><br>`).join('')}
            </td>
            <td>${student.address}</td>
            <td>
              <a href="/edit_students/${student.id}" class="btn btn-sm btn-outline-primary me-1" title="Edit">
                <i class="bi bi-pencil"></i>
              </a>
              <a href="/delete_students/${student.id}" class="btn btn-sm btn-outline-danger" title="Delete">
                <i class="bi bi-trash"></i>
              </a>
            </td>
              </tr>`
            sBody.append(row);
            })
          
          },
          error:function(xhr){
            let error= xhr.response || "an Unexpected Error Happernd(AJAX)";
            alert("DaTA cannot be fetched because of"+ error);
          }
        })
      }
    loadStudent();
    })
  </script>
</body>
  </html>
