{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weekly Attendance Report</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body class="bg-light">
  <div class="container py-5">

    <!-- Go Back Link -->
    <div class="mb-4">
      <a href="{% url 'dashboard_students' %}" class="btn btn-secondary btn-sm">‚Üê Back to Dashboard</a>
    </div>

    <h3 class="text-center mb-4">üóìÔ∏è DAILY Attendance Report</h3>
    <h4 class="mb-4">{% now "M d, Y" %}</h4>

    <!-- Attendance Table -->
    <div id="attendance-table-wrapper" class="table-responsive d-none">
      <table class="table table-bordered table-striped align-middle">
        <thead class="table-dark text-center">
          <tr>
            <th>Date</th>
            <th>Teacher</th>
            <th>Attendance</th>
          </tr>
        </thead>
        <tbody id="attendance-body" class="text-center"></tbody>
      </table>
    </div>

    <!-- Message if no records -->
    <div id="no-records" class="alert alert-warning text-center d-none">
      No attendance records found.
    </div>
  </div>

  <script>
    $(document).ready(function () {
      $.ajax({
        url: "{% url 's_attendance' %}",
        method: "GET",
        headers: {
          "X-Requested-With": "XMLHttpRequest"
        },
        success: function (response) {
          const records = response.records;
          console.log("Records from server:", records);

          if (Array.isArray(records) && records.length > 0) {
            $('#attendance-table-wrapper').removeClass('d-none');

            records.forEach(function (record) {
              $('#attendance-body').append(`
                <tr>
                  <td>${record.date}</td>
                  <td>${record.teacher}</td>
                  <td>${record.attendance}</td>
                </tr>
              `);
            });
          } else {
            $('#no-records').removeClass('d-none');
          }
        },
        error: function () {
          alert("Something went wrong while loading attendance.");
        }
      });
    });
  </script>
</body>
</html>
